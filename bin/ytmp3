#!/usr/bin/python3

import shlex
import subprocess


def run_cmd(command: str | list, quiet: bool = False):
    if isinstance(command, str):
        command = shlex.split(command)
    out = subprocess.DEVNULL if quiet else None
    r = subprocess.run(command, stdout=out)
    return r.returncode


def main():
    import argparse

    ap = argparse.ArgumentParser(description="download youtube videos(s) as mp3")
    ap.add_argument(
        "urls",
        nargs="+",
        help="video URL(s)",
    )
    ap.add_argument(
        "-o",
        type=str,
        help="file output format",
        default="%(title)s.%(ext)s",
    )
    ap.add_argument("-q", action="store_true", help="quiet mode")
    args = ap.parse_args()

    for url in args.urls:
        exitcode = run_cmd(
            f"yt-dlp --extract-audio --audio-format mp3 --embed-thumbnail --add-metadata -o {args.o} {url}",
            args.q,
        )
        if exitcode != 0:
            exit(exitcode)
    exit(0)


if __name__ == "__main__":
    main()
